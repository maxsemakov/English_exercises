<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Упражнения по английскому</title>
    <!-- Подключение Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 text-center">
          <h2 class="my-4">Преврати свою любимую книгу в упражнения по английскому языку</h2>
          <form id="uploadForm" method="post" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="fileInput" class="form-label">Выберите файл</label>
              <input type="file" class="form-control" id="fileInput" name="file" accept=".txt,.epub,.fb2,.docx">
            </div>
            <button type="submit" class="btn btn-primary">Загрузить</button>
          </form>
          <p class="my-3">Вы можете загрузить книгу в следующих форматах: txt, epub, fb2 и docx.</p>
          <div class="progress my-3">
            <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div id="status"></div>
        </div>
      </div>
    </div>

    <!-- Подключение Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- Код JavaScript для отправки файла на сервер и отображения прогресса загрузки -->
<script>
  document.getElementById('uploadForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // показать индикатор прогресса
    document.querySelector('.progress').style.display = 'block';

    // получить выбранный файл
    var fileInput = document.querySelector('input[type=file]');
    var file = fileInput.files[0];

    // создать объект FormData и добавить файл
    var formData = new FormData();
    formData.append('file', file);

    // отправить файл на сервер
    fetch('/upload', {
      method: 'POST',
      body: formData
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // перенаправление на страницу с упражнениями
          window.location.href = '/exercises?result=' + encodeURIComponent(data.result) + '&csv_file=' + encodeURIComponent(data.csv_file);
        } else {
          // обработка ошибки
          alert(data.error);
          document.querySelector('.progress').style.display = 'none';
        }
      });
  });
</script>
  </body>
</html>
